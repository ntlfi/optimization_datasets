# -*- coding: utf-8 -*-
"""MTA Subway Hourly Ridership: Beginning February 2022.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1l_FXm6K4w9613p0YgUJaPU8PmKhO_3WF
"""

# make sure to install these packages before running: sodapy
import pandas as pd
import os
from sodapy import Socrata

# Unauthenticated client only works with public data sets. Note 'None'
# in place of application token, and no username or password:
client = Socrata("data.ny.gov", None)

# Example authenticated client (needed for non-public datasets):
# client = Socrata(data.ny.gov,
#                  MyAppToken,
#                  username="user@example.com",
#                  password="AFakePassword")

# First 2000 results, returned as JSON from API / converted to Python list of
# dictionaries by sodapy.
results = client.get("wujg-7c2s", transit_timestamp="2023-12-27T09:00:00.000", borough="Manhattan", limit=2000)

# Convert to pandas DataFrame
df = pd.DataFrame.from_records(results)

# Modify pandas DataFrame
# results_df["hour"] = results_df["transit_timestamp"].map(lambda x: x[11:13])
df = df[["transit_timestamp", "station_complex_id", "station_complex", "fare_class_category", "ridership", "transfers", "latitude", "longitude"]]
df = df.rename(columns={'transit_timestamp': 'timestamp', 
                        'station_complex_id': 'station_id', 
                        'station_complex': 'station_name'})
df.reset_index(drop=True, inplace=True)

# Save as CSV
current_directory = os.path.dirname(os.path.abspath(__file__))
df.to_csv(f"{current_directory}/hourly_ridership_example.csv")

# Print the first 5 rows as markdown
from IPython.display import display, Markdown
print(df[:5].to_markdown())
